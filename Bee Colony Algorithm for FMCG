import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
def load_and_prepare(file_path):
 df = pd.read_csv(file_path)
 df = df.dropna()
 possible_targets = ['Sales_Quantity', 'Demand', 'Sales', 'Quantity']
 target_col = None
 for col in df.columns:
 if col in possible_targets:
 target_col = col
 break

 if not target_col:
 target_col = df.select_dtypes(include=[np.number]).columns[0]

 print(f"Tespit edilen hedef sütun: {target_col}")

 if 'Date' in df.columns:
 df['Date'] = pd.to_datetime(df['Date'])
 df['Month'] = df['Date'].dt.month

 return df, target_col
path = '/kaggle/input/fmcg-sales-demand-forecasting-andoptimization/extended_fmcg_demand_forecasting.csv'
df, target_col = load_and_prepare(path)
class ABC_Optimizer:
 def __init__(self, demand_val, min_val, max_val, n_bees=30, max_iter=50):
 self.demand = demand_val
 self.min_val = min_val
 self.max_val = max_val
 self.n_bees = n_bees
 self.max_iter = max_iter

 def fitness_function(self, stock_level):
 holding_cost = 2.0 * stock_level
 shortage_cost = 10.0 * max(0, self.demand - stock_level)
 return holding_cost + shortage_cost
 def optimize(self):
 bees = np.random.uniform(self.min_val, self.max_val, self.n_bees)
 fitness = np.array([self.fitness_function(b) for b in bees])
 history = []
 for _ in range(self.max_iter):
 for j in range(self.n_bees):
 k = np.random.randint(0, self.n_bees)
 phi = np.random.uniform(-1, 1)
 new_sol = np.clip(bees[j] + phi * (bees[j] - bees[k]), self.min_val,
self.max_val)
 new_fit = self.fitness_function(new_sol)

 if new_fit < fitness[j]:
 bees[j], fitness[j] = new_sol, new_fit

 history.append(np.min(fitness))

 return bees[np.argmin(fitness)], history
target_demand = df[target_col].mean()
abc = ABC_Optimizer(
 demand_val=target_demand,
 min_val=df[target_col].min(),
 max_val=df[target_col].max()
)
best_stock, cost_history = abc.optimize()
plt.figure(figsize=(14, 6))
plt.subplot(1, 2, 1)
plt.plot(cost_history, color='#E67E22', linewidth=2)
plt.title('ABC Algoritması Optimizasyon Süreci', fontsize=12)
plt.xlabel('İterasyon')
plt.ylabel('Maliyet (Fitness Score)')
plt.grid(True, alpha=0.3)
plt.subplot(1, 2, 2)
sns.histplot(df[target_col], kde=True, color='#3498DB', label='Talep Dağılımı')
plt.axvline(best_stock, color='#C0392B', linestyle='--', linewidth=2, label=f'Optimum
Stok: {best_stock:.2f}')
plt.title(f'Talep Dağılımı ve Optimum Nokta ({target_col})', fontsize=12)
plt.legend()
plt.tight_layout()
plt.show()
print(f"\n--- OPTİMİZASYON RAPORU ---")
print(f"Kullanılan Sütun: {target_col}")
print(f"Ortalama Talep : {target_demand:.2f}")
print(f"Önerilen Stok : {best_stock:.2f}")
print(f"Maliyet Azalımı: %{((cost_history[0]-cost_history[-
1])/cost_history[0])*100:.2f}")
